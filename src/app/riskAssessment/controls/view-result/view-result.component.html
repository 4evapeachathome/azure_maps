<div *ngIf="isDataLoaded" class="common-container risk-assessment-container view-results h-100">
  <ion-grid class="p-0 h-100">
    <ion-row class="h-100">
      <!-- Left Image Panel -->
      <!-- <ion-col size="12" size-sm="12" size-lg="6" class="ra-banner order2">
        <div class="risk-login-banner banner-img"></div>
      </ion-col> -->

      <!-- Right Form Panel -->
      <ion-col size="12" size-sm="12" size-lg="12" class="ra-form-container order1">
        <ion-card class="form-container rafc-container">
          <ion-grid class="d-flex-h-100">
            <ion-row>
              <ion-col size="12" size-sm="12">
                <div class="user-info">
                  <ion-text>Hi, {{ loggedInUser?.username || "User" }}</ion-text>

                  <div class="dropdown">
                    <ion-button shape="round" fill="clear">
                      <ion-icon name="person-circle"></ion-icon>
                    </ion-button>
                    <div class="dropdown-content">
                      <a (click)="logout()">Logout</a>
                    </div>
                  </div>
                </div>
              </ion-col>
            </ion-row>
              <ion-row>
              <ion-col size="12" size-sm="12" size-lg="7">
                <h2>{{ selectedAssessment }}</h2>
              </ion-col>
              <ion-col size="12" size-sm="12" size-lg="5"  class="radio-selected-container">
               <ion-radio-group [(ngModel)]="guidedType" [allowEmptySelection]="true">
                  <ion-radio [value]="guidedType" labelPlacement="end" mode="md" class="guided-label">{{ guidedTypeLabel }}</ion-radio>
                </ion-radio-group>
              </ion-col>
            </ion-row>

<ion-row>
              <ion-col size="12" size-sm="12" size-lg="8">
                   <ion-text class="case-number" disabled="true">Case Number : <span>{{' ' + caseNumber || '<>' }}</span></ion-text>
              </ion-col>
               <ion-col size="12" size-sm="12" size-lg="4" class="risk-item-center">
                   <!-- <ion-text>Here is your QR code:</ion-text> -->
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col size="12" size-sm="12" size-lg="9" style="margin-bottom: 16px;">
                    <ion-text>
                  Thanks for taking <strong>{{ selectedAssessment }} </strong>.
                  </ion-text>
              </ion-col>
               <ion-col size="12" size-sm="12" size-lg="3" class="risk-item-center">
                  <ion-text>Here is your QR code:</ion-text>
                 <div *ngIf="qCodeValue !== ''">
                 
                 
                    <div class="qr-code-wrapper mobile-center-align">
                        <div *ngIf="qCodeValue !== ''">
                       <qrcode #qrcodeElement [qrdata]="qCodeValue" [width]="100" [errorCorrectionLevel]="'M'"></qrcode>
                   </div>
                      </div>
                      <ion-text>Code: {{assessmentNumber}}</ion-text>
               
                </div> 
              </ion-col>
            </ion-row>

            
             <ion-row>
              <ion-col size="12" size-sm="12" size-lg="9">
                
  <ion-row class="assessment-summary-text" *ngIf="isDataLoaded && (isDaAssessment || isHitAssessment || isSSripa)">
                <ion-col size="12" size-sm="12" class="p-0">
              
              <ion-row class="hits-summary-text" *ngIf="isDaAssessment || isHitAssessment">
                <ion-col >
                  <strong> Your score : </strong><span class="score">{{ score }}</span><br /><br />
                  <ng-container *ngIf="isHitAssessment && guidedType === 'staff-guided'" >
                    <strong>Note:</strong><br /> {{ note }}<br /><br />
                    <ng-container *ngIf="hitsCriticalAlert">
                      <strong>Caution:</strong> <br />{{ caution }}
                    </ng-container>                    
                  </ng-container>
                  <ng-container *ngIf="isDaAssessment">
                  <ng-container *ngIf="(guidedType === 'staff-guided') && isDaAssessment; else selfGuided">
                    <strong>Level of Danger : </strong> <span class="score">{{ levelofdanger }}</span><br />
                  </ng-container>
                  <ng-template #selfGuided>
                    <strong class="highlight">
                      Please talk to your service provider about what the Danger Assessment means in your situation.
                    </strong><br />
                  </ng-template>
                </ng-container>
                </ion-col>


              </ion-row>
              <ion-row class="hits-summary-text" *ngIf="isSSripa && highratedQuestions">
                <ion-col>
                
                  <ng-container *ngIf="guidedType === 'staff-guided'; else selfGuided">
                    <ion-text ><span class="score">Please expediate action.</span></ion-text>
                  </ng-container>
                  <ng-template #selfGuided>
                  <span class="score">
                      Take action immediately; talk to your service providers for assistance.
                   </span><br />
                  </ng-template>
                </ion-col>
              </ion-row>
<ion-row class="assessment-summary-text" *ngIf="isRatAssessment">
              <ion-col *ngFor="let item of AssessmentResultList">               

                   <ion-row>
                    <ion-col size="12" size-sm="12">
                        <ion-text >
            
                  Your score:<span class="score">{{ item.assessmentScore }}</span><br /><br />
                  <div class="result" *ngIf="guidedType?.toLowerCase() == 'staff-guided'">
                    <strong>Status: <span class="highlight">{{item.assessmentScore >= 20 ?
                    'Positive' : 'Negative'}}</span></strong>
                    </div>
                    </ion-text>
                    </ion-col>
                  </ion-row>

                
                  <ion-row *ngIf="qCodeValue !== ''"> 
                  <ion-col size="12" size-sm="12" >
                    <ion-text><strong>Here is your QR code:</strong></ion-text>
                    <div class="qr-code-wrapper mobile-center-align">
                        <div *ngIf="qCodeValue !== ''">
                       <qrcode #qrcodeElement [qrdata]="qCodeValue" [width]="100" [errorCorrectionLevel]="'M'"></qrcode>
                   </div>
                   <ion-text>Code: {{assessmentNumber}}</ion-text>
                      </div>
                  </ion-col>
                </ion-row> 
                
                  <ion-row>
                    <ion-col size="12" size-sm="12">
                       
                       <div class="summary">Summary:</div>
                    </ion-col>
                  </ion-row>
                  
               

                   <!-- <div>
                    <app-assessment-table [selectedAssessment]="this.selectedAssessment"></app-assessment-table>
                  </div> -->

             
              </ion-col>
            </ion-row>
              
</ion-col>
              
            </ion-row>


          
                  
              </ion-col>
               <ion-col size="12" size-sm="12" size-lg="3" class="risk-item-center">
                 <div class="risk-meter" *ngIf="guidedType ==='staff-guided' && (isHitAssessment || isDaAssessment)">
                   
                   <app-summarypage  [range]="rangevalue" [riskScore]="score"></app-summarypage>
             
                </div>
                 <div>
                  
            
              
              </div>   
              </ion-col>
            </ion-row>
             <ion-row>
                <ion-col>
            <table class="assessment-table-container hits-assessment-table">
              <thead>
                <tr>
                  <th scope="col" style="text-align: left; width: 75px;">S No.</th>
                  <th scope="col" style="text-align: left;">Question</th>
                  <th scope="col" style="text-align: left; width: 130px;">Answer</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let item of responseJson; let i = index">
                  <!-- Parent Row -->
                  <tr>
                    <td>{{ i + 1 }}</td>
                    <td>{{ item.question }}</td>
                    <td style="text-transform: capitalize;">{{ item.answer }}</td>
                  </tr>
                  <!-- Child Rows (if DAChild exists and has data) -->
                  <tr *ngFor="let child of item.DAChild; let j = index">
                    <td>{{ i + 1 }}{{ getCharFromCode(97 + j) }}</td> <!-- Generates 3a, 3b, etc. -->
                    <td>{{ child.question }}</td>
                    <td style="text-transform: capitalize;">{{ child.answer }}</td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
                </ion-col>
            </ion-row>

















           
        
          

            

         

          </ion-grid>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>