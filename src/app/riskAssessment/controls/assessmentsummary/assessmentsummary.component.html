<div class="common-container risk-assessment-container h-100">
  <ion-grid class="p-0 h-100">
    <ion-row class="h-100">
      <!-- Left Image Panel -->
      <ion-col size="12" size-sm="6" class="ra-banner order2">
        <div class="risk-login-banner banner-img"></div>
      </ion-col>

      <!-- Right Form Panel -->
      <ion-col size="12" size-sm="6" class="ra-form-container order1">
        <ion-row>
<ion-col>
          <div class="top-bar">
          <ion-label>Case Number</ion-label>
          <ion-input 
            [(ngModel)]="caseNumber" 
            [placeholder]="caseNumberPlaceholder"></ion-input>
          <div class="user-info">
            <div>Hi, {{ loggedInUser?.username || userName }}</div>
            <div class="guided-options">
              <ion-label>{{ guidedType }}</ion-label>
            </div>
          </div>
        </div>
</ion-col>
        </ion-row>
<ion-row>
  <h1 class="assessment-title">{{ assessmentTitle }}</h1>

  <!-- Test Results Section -->
  <div class="test-results">
    <h2>{{ testResultsTitle }}</h2>
    <ion-card>
      <ion-card-content>
        <div class="result-header">
          <span class="result-label">{{ testResultLabel }}</span>
          <span class="result-value danger">{{ riskValue }}%</span>
        </div>
        <p>{{ recommendationIntro }}</p>
        <p>{{ recommendationText }}</p>
      </ion-card-content>
    </ion-card>
  </div>
</ion-row>
<ion-row>
  <ion-col>
        <!-- Unique Access Button -->
        <div class="qr-code-wrapper">
          <qrcode #qrcodeEl [qrdata]="myAngularxQrCode" [width]="256" [errorCorrectionLevel]="'M'"></qrcode>
          <p class="access-code">{{ accessCodeLabel }}: {{ accessCode }}</p>
        </div>
  </ion-col>
  <ion-col>        <!-- Risk Meter -->
        <div class="risk-meter">
          <h3>{{ riskLevelsTitle }}</h3>
          <div class="meter-container">
            <canvas id="risk-gauge"></canvas>
            <p>{{ stressCurveLabel }}: {{ riskValue }}%</p>
          </div>
        </div>
        <ion-button (click)="downloadPDF()">Download as PDF</ion-button>
  </ion-col>
</ion-row>



      </ion-col>
    </ion-row>
  </ion-grid>
</div>
<div #pdfExportContainer [style.display]="hidePdfContainer ? 'none' : 'block'" 
     style="position: absolute; left: -9999px; top: -9999px; width: 800px; background: white; padding: 20px;">
  <h1>{{ assessmentTitle }}</h1>
  <p><strong>Case Number:</strong> {{ caseNumber }}</p>
  <p><strong>User:</strong> {{ loggedInUser?.username || userName }}</p>
  <p><strong>{{ testResultsTitle }}</strong></p>
  <p>{{ testResultLabel }} - {{ riskValue }}%</p>
  <p>{{ recommendationIntro }}</p>
  <p>{{ recommendationText }}</p>
  <p><strong>{{ riskLevelsTitle }}:</strong> {{ stressCurveLabel }} - {{ riskValue }}%</p>
  <p><strong>{{ accessCodeLabel }}:</strong> {{ accessCode }}</p>
  <img #qrImage alt="QR Code Image" style="width: 150px; height: 150px;" />
</div>