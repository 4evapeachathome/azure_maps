<div *ngIf="loaded" class="common-container risk-assessment-container h-100">
  <ion-grid class="p-0 h-100">
    <ion-row class="h-100">
      <!-- Left Image Panel -->
      <ion-col size="12" size-sm="12" size-lg="5" class="ra-banner order2">
        <div class="risk-login-banner banner-img"></div>
      </ion-col>

      <!-- Right Form Panel -->
      <ion-col size="12" size-sm="12" size-lg="7" class="ra-form-container order1">
        <ion-card class="form-container rafc-container">
          <ion-grid class="d-flex-h-100">
            <ion-row>
              <ion-col size="12" size-sm="12">
                <div class="user-info">
                  <ion-text>Hi, {{ loggedInUser?.username || "User" }}</ion-text>

                  <!-- <div class="guided-options">
              <ion-label>{{ guidedType }}</ion-label>
            </div>
                 -->


                  <div class="dropdown">

                    <ion-button shape="round" fill="clear">
                      <ion-icon name="person-circle"></ion-icon>
                    </ion-button>
                    <div class="dropdown-content">
                      <a (click)="logout()">Logout</a>

                    </div>


                  </div>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-sm="12" size-lg="5">
                <ion-text class="case-number" disabled="true">Case Number : <span>{{' ' + caseNumber || '<>' }}</span></ion-text>
              </ion-col>
              <ion-col size="12" size-sm="12" size-lg="7" class="radio-selected-container">
                <ion-radio-group [(ngModel)]="guidedType" >
                  <ion-radio [value]="guidedType" labelPlacement="end" mode="md" class="guided-label">{{ guidedTypeLabel }}</ion-radio>
                </ion-radio-group>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-sm="12">
                <h2>{{ selectedAssessment }}</h2>
              </ion-col>
            </ion-row>
            <ion-row class="hits-summary-text" *ngIf="isHitsAssessment">
              <ion-col>
                <ion-text>
                  Thanks for taking this assessment.<br /><br />
                  <strong> Here is your score: </strong><br /><span class="score">{{ riskValue }}</span><br /><br />
                  <ng-container *ngIf="guidedType ==='staff-guided'">
                    <strong>Note:</strong><br /> {{ note }}<br />
                    <strong>Caution:</strong><br /> {{ caution }}
                   </ng-container>  
                </ion-text>
              </ion-col>
            </ion-row>

            <ion-row class="hits-summary-text" *ngIf="isDanger">
              <ion-col>
                <ion-text>
                  Thanks for taking this assessment.<br /><br />
                  <strong> Here is your score: </strong><br /><span class="score">{{ riskValue }}</span><br /><br />
                  <ng-container *ngIf="guidedType === 'staff-guided'; else selfGuided">
                    <strong>Level of Danger:</strong><br /> {{ levelofdanger }}<br />
                  </ng-container>
                  <ng-template #selfGuided>
                    <strong>
                      Please talk to your service provider about what the Danger Assessment means in your situation.
                    </strong><br />
                  </ng-template>
                </ion-text>
              </ion-col>
            </ion-row>

            <ion-row class="assessment-summary-text" *ngIf="selectedAssessment?.toLowerCase() == this.ASSESSMENT_TYPE.WEB?.toLowerCase()">
              <ion-col>
                <ion-text>
                  Thanks for taking this assessment.<br /><br />
                  <strong> Here is your score: </strong><br /><span class="score">{{ riskValue }}</span><br /><br />
                  <div class="rat-score" *ngIf="guidedType?.toLowerCase() == 'staff-guided'"><strong>Status: </strong>{{riskValue >= 20 ? 'Positive' : 'Negative'}}</div>
                </ion-text>
              </ion-col>
            </ion-row>

            <ion-row class="hits-summary-text" *ngIf="isSSripa">
              <ion-col>
                <ion-text>
                  Thanks for taking this assessment.<br /><br />
                </ion-text>
              </ion-col>
            </ion-row>


            <ion-row>
              <ion-col size="12" size-sm="12" size-lg="7" class="p-0">            
                <ion-row *ngIf="isSSripa || isHitsAssessment || isDanger || (selectedAssessment?.toLowerCase() == this.ASSESSMENT_TYPE.WEB?.toLowerCase())">
                  <ion-col size="12" size-sm="12">
                    <ion-text>Here is your QR code:</ion-text>
                    <div class="qr-code-wrapper" *ngIf="QrcodeUrl">
                      <qrcode #qrcodeElement [qrdata]="QrcodeUrl" [width]="200" [errorCorrectionLevel]="'M'"></qrcode>
                    </div>
                  </ion-col>
                </ion-row>            
              </ion-col>          
              <ion-col size="12" size-sm="12" size-lg="5" class="p-0">
                <ion-row class="risk-meter" *ngIf="guidedType ==='staff-guided' && (isHitsAssessment || isDanger)">
                  <app-summarypage #riskMeterRef [range]="rangevalue" [isRiskRed]="criticalalert" [riskScore]="riskValue"></app-summarypage>
                </ion-row>
                       
              </ion-col>
              <ion-row>
                <ion-button  (click)="downloadPDF()" color="primary" size="small">Download as PDF</ion-button>
              </ion-row>   
            </ion-row>
            <!--Table to handle response for all the assessments-->
            <ion-row>
              <table class="assessment-table-container hits-assessment-table">
                <thead>
                  <tr>
                    <th scope="col" style="text-align: left;">S No.</th>
                    <th scope="col" style="text-align: left;">Question</th>
                    <th scope="col" style="text-align: left;">Answer</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let item of responseJson; let i = index">
                    <!-- Parent Row -->
                    <tr>
                      <td>{{ i + 1 }}</td>
                      <td>{{ item.question }}</td>
                      <td style="text-transform: capitalize;">{{ item.answer }}</td>
                    </tr>
                    <!-- Child Rows (if DAChild exists and has data) -->
                    <tr *ngFor="let child of item.DAChild; let j = index">
                      <td>{{ i + 1 }}{{ getCharFromCode(97 + j) }}</td> <!-- Generates 3a, 3b, etc. -->
                      <td>{{ child.question }}</td>
                      <td style="text-transform: capitalize;">{{ child.answer }}</td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>

              <!-- <app-assessment-table [selectedAssessment]="this.selectedAssessment"></app-assessment-table> -->
            </ion-row>



          </ion-grid>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>
